<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroDrift Pro</title>
    <style>
        body {
            background-color: #1a1a1a; color: #e0e0e0;
            font-family: -apple-system, sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; padding: 20px;
        }
        .container {
            width: 100%; max-width: 380px; background: #2c2c2c; padding: 25px;
            border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .header { display: flex; justify-content: space-between; margin-bottom: 20px; color: #888; font-size: 0.9em; }
        .timer-badge { border: 1px solid #4caf50; color: #4caf50; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
        
        .control-group { margin-bottom: 25px; position: relative; }
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        label { font-size: 1em; font-weight: 500; color: #fff; }
        .value-text { color: #aaa; font-size: 1.1em; }
        .sub-label { display: block; color: #666; font-size: 0.8em; margin-top: -5px; margin-bottom: 10px; }

        input[type=range] { -webkit-appearance: none; width: 100%; height: 4px; background: #444; border-radius: 2px; outline: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; background: #fff; border-radius: 50%; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        .switch-row { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider-switch { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 34px; }
        .slider-switch:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider-switch { background-color: #4caf50; }
        input:checked + .slider-switch:before { transform: translateX(24px); }

        #startBtn {
            background: transparent; border: none; color: #888;
            font-size: 1.8em; cursor: pointer; width: 100%; margin-top: 20px; transition: 0.3s;
        }
        #startBtn.active { color: #fff; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <span>Help</span>
            <span class="timer-badge">TIMER</span>
            <span>Defaults</span>
        </div>

        <div class="control-group">
            <div class="label-row">
                <label>Frequency</label>
                <span id="freqVal" class="value-text">1 Hz</span>
            </div>
            <span class="sub-label" id="freqType">For Deep Sleep</span>
            <input type="range" id="freqSlider" min="0.5" max="40" value="1" step="0.5">
        </div>

        <div class="control-group">
            <div class="label-row">
                <label>Tone</label>
                <span id="toneVal" class="value-text">214 Hz</span>
            </div>
            <input type="range" id="toneSlider" min="100" max="1000" value="214" step="1">
        </div>

        <div class="control-group">
            <div class="label-row">
                <label>Volume</label>
                <span id="volVal" class="value-text">33%</span>
            </div>
            <input type="range" id="volSlider" min="0" max="1" value="0.33" step="0.01">
        </div>

        <div class="control-group">
            <div class="label-row">
                <label>Noise</label>
                <span id="noiseVal" class="value-text">None</span>
            </div>
            <input type="range" id="noiseSlider" min="0" max="1" value="0" step="0.01">
        </div>

        <div class="switch-row">
            <label>Monaural / Binaural</label>
            <label class="switch">
                <input type="checkbox" id="modeSwitch" checked>
                <span class="slider-switch"></span>
            </label>
        </div>

        <button id="startBtn">Start</button>
    </div>

    <script>
        let audioCtx, oscLeft, oscRight, mainGain, noiseNode, noiseGain, merger;
        let isPlaying = false;

        const startBtn = document.getElementById('startBtn');
        const freqSlider = document.getElementById('freqSlider');
        const toneSlider = document.getElementById('toneSlider');
        const volSlider = document.getElementById('volSlider');
        const noiseSlider = document.getElementById('noiseSlider');
        const modeSwitch = document.getElementById('modeSwitch');

        // Aggiornamenti UI
        freqSlider.addEventListener('input', (e) => {
            const val = e.target.value;
            document.getElementById('freqVal').textContent = val + " Hz";
            document.getElementById('freqType').textContent = val < 4 ? "For Deep Sleep" : val < 8 ? "For Meditation" : "For Focus";
            updateNodes();
        });

        toneSlider.addEventListener('input', (e) => {
            document.getElementById('toneVal').textContent = e.target.value + " Hz";
            updateNodes();
        });

        volSlider.addEventListener('input', (e) => {
            document.getElementById('volVal').textContent = Math.round(e.target.value * 100) + "%";
            if(mainGain) mainGain.gain.setTargetAtTime(e.target.value, audioCtx.currentTime, 0.1);
        });

        noiseSlider.addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            document.getElementById('noiseVal').textContent = val === 0 ? "None" : Math.round(val * 100) + "%";
            if(noiseGain) noiseGain.gain.setTargetAtTime(val, audioCtx.currentTime, 0.1);
        });

        modeSwitch.addEventListener('change', updateNodes);

        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            // Setup Noise (Pink Noise)
            const bufferSize = audioCtx.sampleRate * 2;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            let b0=0, b1=0, b2=0, b3=0, b4=0, b5=0, b6=0;
            for (let i = 0; i < bufferSize; i++) {
                let white = Math.random() * 2 - 1;
                b0 = 0.99886 * b0 + white * 0.0555179; b1 = 0.99332 * b1 + white * 0.0750759;
                b2 = 0.96900 * b2 + white * 0.1538520; b3 = 0.86650 * b3 + white * 0.3104856;
                b4 = 0.55000 * b4 + white * 0.5329522; b5 = -0.7616 * b5 - white * 0.0168980;
                data[i] = (b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362) * 0.11;
                b6 = white * 0.115926;
            }
            noiseNode = audioCtx.createBufferSource();
            noiseNode.buffer = buffer;
            noiseNode.loop = true;
            noiseGain = audioCtx.createGain();
            noiseGain.gain.value = noiseSlider.value;
            noiseNode.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);

            merger = audioCtx.createChannelMerger(2);
            mainGain = audioCtx.createGain();
            mainGain.gain.value = volSlider.value;
            merger.connect(mainGain);
            mainGain.connect(audioCtx.destination);
        }

        function updateNodes() {
            if (!isPlaying) return;
            const baseTone = parseFloat(toneSlider.value);
            const beat = parseFloat(freqSlider.value);
            const isBinaural = modeSwitch.checked;

            oscLeft.frequency.setTargetAtTime(baseTone, audioCtx.currentTime, 0.1);
            
            if (isBinaural) {
                // Binaurale: frequenze diverse nei due canali
                oscRight.frequency.setTargetAtTime(baseTone + beat, audioCtx.currentTime, 0.1);
            } else {
                // Monaurale: stessa frequenza (battito creato fisicamente)
                oscRight.frequency.setTargetAtTime(baseTone, audioCtx.currentTime, 0.1);
            }
        }

        function start() {
            initAudio();
            oscLeft = audioCtx.createOscillator();
            oscRight = audioCtx.createOscillator();
            oscLeft.type = oscRight.type = 'sine';

            oscLeft.connect(merger, 0, 0);
            oscRight.connect(merger, 0, 1);

            updateNodes();
            oscLeft.start();
            oscRight.start();
            noiseNode.start();
        }

        function stop() {
            if(oscLeft) oscLeft.stop();
            if(oscRight) oscRight.stop();
            if(noiseNode) noiseNode.stop();
            if(audioCtx) audioCtx.close();
            audioCtx = null;
        }

        startBtn.addEventListener('click', () => {
            if (!isPlaying) {
                start();
                startBtn.textContent = "Stop";
                startBtn.classList.add("active");
                isPlaying = true;
            } else {
                stop();
                startBtn.textContent = "Start";
                startBtn.classList.remove("active");
                isPlaying = false;
            }
        });
    </script>
</body>
</html>
